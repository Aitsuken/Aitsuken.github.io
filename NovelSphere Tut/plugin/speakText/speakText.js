"use strict";!function(){function u(e,o,t){this.context=e,this.urlList=o,this.onload=t,this.bufferList=new Array,this.loadCount=0}u.prototype.loadBuffer=function(o,t){var e=new XMLHttpRequest;e.open("GET",o,!0),e.responseType="arraybuffer";var r=this;e.onload=function(){r.context.decodeAudioData(e.response,function(e){e?(r.bufferList[t]=e,++r.loadCount==r.urlList.length&&r.onload(r.bufferList)):alert("error decoding file data: "+o)},function(e){console.error("decodeAudioData error",e)})},e.onerror=function(){alert("BufferLoader: XHR error")},e.send()},u.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)};var t={a:"あかさたなはまやらわアカサタナハマヤラワがざだばぱガザダバパぁゃゎァャヮ",i:"いきしちにひみりイキシチニヒミリぎじぢびぴギジチビピぃィ",u:"うくすつぬふむゆるウクスツヌフムユルぐずづぶぷグズヅブプヴぅゥゅュ",e:"えけせてねへめれエケセテネヘメレげぜでべぺゲゼデベペぇェ",o:"おこそとのほもよろをオコソトノホモヨロヲごぞどぼぽゴゾドボポぉょォョ",slient:"っッ・！？、。（）…―「」『』　"};function i(e){for(var o in t)if(0<=t[o].indexOf(e))return o;return"n"}var a=function(){var e;if(e=window.AudioContext||window.webkitAudioContext){var n=new e,i={};return!browser.isIOs&&!browser.isAndroid||window.o2WrapperNativeInjected||$("body").one("touchstart",function(e){a.playDummy()}),{playAudio:function(e){var o=i[e];if(o){var t=n.createBufferSource();t.buffer=o,t.connect(n.destination),t.start(0),t.onended=function(){t.onended=void 0,t.disconnect()}}},loadAudio:function(o){var t=Object.keys(o),r=$.Deferred();return new u(n,t.map(function(e){return ResourceLoader.getFullAudioPath(o[e])}),function(e){for(var o=0;o<e.length;o++)i[t[o]]=e[o];r.resolve()}).load(),r.promise()},playDummy:function(){var e=n.createBufferSource();e.connect(n.destination),e.start(0)}}}var r={};return{loadAudio:function(e){var o=[];for(var t in e)r[t]=new Audio,o.push(ResourceLoader.loadAudio(e[t],!1,r[t]));return $.when.apply($,o)},playAudio:function(e){var o=r[e];o&&0!=o.readyState&&(o.currentTime=0,o.play())}}}(),o=$.Deferred(),r=void 0;function n(e){return r&&r==e||(r=e,o=a.loadAudio({a:e+"1",i:e+"2",u:e+"3",e:e+"4",o:e+"5",n:e+"6"})),o}conductor?n("voice0"):$(o2).one("init",function(){n("voice0")});var s=!(MessageLayer.textCustomizers.speakTextCustomizer=function(e,o,r){var n=-1;this.perform=function(){for(var e=0;e<r.length;e++){var o=r[e];if(o.styles.visible&&0!=o.styles.opacity&&!(e<=n||s&&o2.skipMode!=o2.SKIP_MODE_NONE)){var t=i(o.text);a.playAudio(t),n=e}}}});Tag.actions.speaktext=new TagAction({rules:{enable:{type:"BOOLEAN"},ignore_skip:{type:"BOOLEAN"},prefix:{type:"STRING"}},action:function(e){var o=o2.currentMessageLayer.textCustomizers.indexOf("speakTextCustomizer");"ignore_skip"in e&&(s=e.ignore_skip);var t=this;if("enable"in e)if(e.enable){if(-1==o)return o2.currentMessageLayer.textCustomizers.push("speakTextCustomizer"),n("prefix"in e?e.prefix:"voice0").done(function(){setTimeout(function(){t.done()})}),1}else-1!=o&&o2.currentMessageLayer.textCustomizers.splice(o,1);return e.prefix?(n(e.prefix).done(function(){setTimeout(function(){t.done()})}),1):0}})}();