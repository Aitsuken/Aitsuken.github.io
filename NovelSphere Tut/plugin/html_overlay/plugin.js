"use strict";var _Overlay;Tag.actions.showoverlay=new TagAction({rules:{filename:{type:"STRING",required:!0},event:{type:/fullscreen|element|none/,defaultValue:"none"},autoresize:{type:"BOOLEAN",defaultValue:!1}},action:function(t){var o=this,n=this.isOpen();this.isOverlayOpen=!1,this.isPerformingCallback=!1;var i=Tag.actions.showoverlay.showOverlay.call(this,t,function(){n||o.done()},function(){if(n){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);return Tag.actions.showoverlay.performCallback.call(o,i,t)}i()});return this.exitScope=i,this.conductor.wait("overlay callback"),1},closeAction:function(t){return t.isOverlayOpen?(t.isPerformingCallback=!1,this.conductor.wait("overlay callback"),this.keepStack(),1):0},performCallback:function(t,e){var o=this;if(this.isPerformingCallback)return!1;this.isPerformingCallback=!0;var n=this.conductor.tagActions.close;this.conductor.tagActions.close=new TagAction({action:function(){return t(),o.conductor.tagActions.close=n,o.jumpToTag(o.getCloseTag()),0}}),this.jumpToTag(this,!0);var i=this.makeScopeVars(e);return this.setScopeVars(i),this.conductor.trigger("overlay callback"),!0},showOverlay:function(e,t,o){if(!this.isOverlayOpen){this.isOverlayOpen=!0;var n=function(t,e,o,n){var i=$("<div>").css({left:"0",top:"0",width:"100%",height:"100%",position:"absolute",zIndex:20});i.appendTo("body");var r,a=!1,s=!1;function c(){a&&s&&(r.call(i,o,n),e())}return _Overlay=function(t){s=!(_Overlay=void 0),r=t,c()},i.load(t,function(){a=!0,c()}),i}("plugin/html_overlay/html/"+e.filename,function(){$(o2).bindFirst("click",r),$(o2).bindFirst("rclick",r),i.forEach(function(t){n.on(t,r)}),t()},o,e),i="touchstart touchmove touchcancel touchend mousemove mouseup mousedown mouseleave".split(" ");return e.autoresize&&($(window).on("resize",a),a()),function(){n.remove(),$(o2).off("click",r),$(o2).off("rclick",r),i.forEach(function(t){n.off(t,r)}),e.autoresize&&$(window).off("resize",a),this.isOverlayOpen=!1}.bind(this)}function r(t){("fullscreen"===e.event||"element"===e.event&&$.contains(n[0],t.target)||n.is(t.target))&&t.stopPropagation()}function a(){n.css({transform:$("#main-wrapper").css("transform"),left:$("#main-wrapper").css("left"),top:$("#main-wrapper").css("top"),transformOrigin:$("#main-wrapper").css("transformOrigin"),bottom:"",right:""})}}});